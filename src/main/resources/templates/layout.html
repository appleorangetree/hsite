<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:fragment="htmlhead">
    <meta charset="utf-8"></meta>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
    <meta name="renderer" content="webkit" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
    <meta name="description" content=""></meta>
    <meta name="author" content=""></meta>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"></meta>
    <link rel="icon" href="/img/icon.ico" type="image/x-icon" />
   	<title >LazySheep</title>
   	<link rel="stylesheet" th:href="@{/vendor/fontawesome/css/font-awesome.min.css}" />
    <link rel="stylesheet" th:href="@{/vendor/simple-line-icons/css/simple-line-icons.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/animate.css/animate.min.css}"/>
    <link rel="stylesheet" th:href="@{/vendor/toastr/toastr.min.css}"/>
  	<link rel="stylesheet" th:href="@{/media/css/bootstrap.css}" />
    <link rel="stylesheet" th:href="@{/media/css/app.css}" />
    <link rel="stylesheet" th:href="@{/media/css/theme-i.css}" />
      <link rel="stylesheet" th:href="@{/plugins/highlight/css/solarized_dark.min.css}" />
      <link rel="stylesheet" th:href="@{/css/hover-min.css}" />
      <!--<link rel="stylesheet" href="/static/css/hover-min.css" media="all"/>-->
      <link rel="stylesheet" href="plugins/editormd/css/editormd.css" />
      <link rel="stylesheet" href="css/inote.css" />

      <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
      <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>





  </head>

  <body class="layout-fixed">
    <div th:fragment="navbar"  class="wrapper"  role="navigation">
		<div th:replace="fragments/header :: header">Header</div>
		<div th:replace="fragments/left :: left">left</div>
		<div th:replace="fragments/sidebar :: sidebar">sidebar</div>
		<div layout:fragment="content" id="content" ></div>
		<div th:replace="fragments/footer :: footer">footer</div>
    </div>
	<div th:replace="fragments/alert :: alert">alert</div>

    <!-- Modal -->
    <div class="modal fade" id="postModal" tabindex="-1" role="dialog" aria-labelledby="postModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-editor">
            <div class="modal-content" id="savaArticlePage">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">写文章</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label for="postTitle">标题</label>
                                <input type="text" class="form-control" id="postTitle" v-model="title"/>
                                <input type="hidden" name="" id="postId"/>
                                <input type="hidden" name="" id="postContent"/>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="postTag">分类</label>
                                <select id="postCategory" class="form-control">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label for="postTag">标签</label>
                                <input type="text" class="form-control" id="postTag" v-model="tag"/>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <iframe id="postContentIframe" src="#" name="postContentIframe" frameborder="0" width="100%" height="620" scrolling="no"></iframe>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button v-on:click="savaarticle" type="button" class="btn btn-primary" id="savePost">保存</button>
                </div>

            </div>
        </div>
    </div>

    <script th:src="@{/webjars/jquery/2.2.4/dist/jquery.min.js}"></script>
    <script th:src="@{/webjars/jquery-form/3.51/jquery.form.js}"></script>
	<script th:src="@{/webjars/bootstrap/3.3.6/dist/js/bootstrap.min.js}"></script>
	<script th:src="@{/vendor/modernizr/modernizr.custom.js}" ></script>
	<script th:src="@{/vendor/jQuery-Storage-API/jquery.storageapi.js}" ></script>
	<script th:src="@{/media/js/app.js}" ></script>
    <script th:src="@{/js/comm.js}" ></script>
	<script th:src="@{/js/layout.js}" ></script>
    <script th:src="@{/js/loadcategory.js}" ></script>
	<script th:src="@{/js/collect.js}" ></script>
    <script th:src="@{/js/letter.js}" ></script>
	<script th:src="@{/vendor/parsleyjs/dist/parsley.min.js}"></script>
	<script th:src="@{/vendor/toastr/toastr.min.js}"></script>
    <script type="text/javascript" src="http://v3.jiathis.com/code_mini/jia.js?uid=2126448" charset="utf-8"></script>

    <!-- SlimScroll -->
    <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src='plugins/fastclick/fastclick.min.js'></script>
    <!-- AdminLTE App -->
    <script src="js/jquery.form.min.js"></script>
    <script src="js/json2-min.js"></script>
    <script src="js/jquery.md5.js"></script>
    <script src="plugins/editormd/editormd.min.js"></script>
    <script src="plugins/highlight/js/highlight.min.js"></script>
    <script src="dist/js/app.min.js"></script>
    <script src="js/util.js"></script>

    <!--&lt;!&ndash; jQuery &ndash;&gt;-->
    <!--<script src="plugins/jQuery/jQuery-2.1.3.min.js"></script>-->

    <!--&lt;!&ndash; Bootstrap Core JavaScript &ndash;&gt;-->
    <!--<script src="freelancer/js/bootstrap.min.js"></script>-->

    <!-- Plugin JavaScript -->
    <script src="freelancer/js/jquery.easing.min.js"></script>
    <script src="freelancer/js/classie.js"></script>
    <script src="freelancer/js/cbpAnimatedHeader.js"></script>

    <!-- Message Form JavaScript -->
    <script src="freelancer/js/jqBootstrapValidation.js"></script>

    <!-- Custom JavaScript -->
    <script src="freelancer/js/freelancer.js"></script>
    <script src="plugins/painlayer/js/jquery.plainoverlay.min.js"></script>
    <script src="js/marked.min.js"></script>
    <script src="plugins/highlight/js/highlight.min.js"></script>
    <script src="js/json2-min.js"></script>
    <script src="plugins/venobox/venobox.min.js"></script>
    <script src="js/util.js"></script>
    <script src="js/main.js"></script>

    <script th:src="@{/webjars/vue/1.0.24/vue.min.js}"></script>
    <script th:src="@{/webjars/vue-resource/0.7.0/dist/vue-resource.min.js}"></script>

    <script th:inline="javascript">

        locationUrl('/standard/my/0','home');

//	/*<![CDATA[*/
//	    var size = /*[[${size}]]*/ 0;
//	    if(size!=null && size>0){
//	    	locationUrl('/standard/my/0','home');
//		  }else{
////			  locationUrl('/tool','tool');
//		  }
//	    var config = /*[[${config}]]*/;
//		if(null != config){
//			$("#layoutConfigId").val(config.id);
//		}
//	/*]]>*/

	</script>

    <script>

        $(function () {

            $postModal = $('#postModal');

            $postModal.on('show.bs.modal', function(event) {

                $('#postContentIframe').attr('src', 'write');
                var $button = $(event.relatedTarget);

                if ($button.attr('class').indexOf("post-update") > 0) {
                    var postId = $button.find('input[type="hidden"]:eq(0)').val();
                    $.get('/i/posts/' + postId, function (res) {
                        if (res.success) {
                            var post = res.data.post;
                            $('#postId').val(postId);
                            $('#postTitle').val(vlidField(post.title));
                            $('#postTag').val(vlidField(post.tag));
                            $('#postContent').val(post.content);
                        } else {
                            alert(res.msg);
                        }

                    });

                } else {
                    $('#postId').val('');
                    $('#postTitle').val('');
                    $('#postTag').val('');
                    $('#postContent').val('');
                }

            });

        });

    </script>

    <script type='text/javascript'>

        Vue.http.options.emulateJSON = true;
        var savaArticlePage = new Vue({
            el: '#savaArticlePage',
            data: {
                'title': '',
                'tag': '',
                'content': ''
            },
            methods: {
                savaarticle: function(event){

                    var editorContentArea = $(window.frames["postContentIframe"].document).find("#editormd>textarea");
                    var content = editorContentArea.val();
                    var datas={
                        title: this.title,
                        tag: this.tag,
                        content: content
                    };
                    this.$http.post('/article/savaarticle',datas).then(function(response){

                        if(response.data.rspCode == '000000'){
                            alert("保存成功")
                            window.open(response.data.data, '_self');
                        }else{
                            $("#errorMsg").html(response.data.rspMsg);
                            $("#errorMsg").show();
                        }
                    }, function(response){
                        console.log('error');
                    })
                }
            }
        })
    </script>

</body>
</html>
